import{r as i,u as h,j as e,I as S,B as y,c as _,h as k,d as B,e as p,f as I,i as D,k as M,l as T,m as A}from"./index-Cd3CDbj4.js";const b=s=>s.chat.phoneNumber,E=s=>s.chat.notifications,H="_wrapper_e96ev_1",R="_container_e96ev_7",x={wrapper:H,container:R},L="_wrapper_1ya88_1",P="_input_1ya88_6",N={wrapper:L,input:P},F=()=>{const s=h(),[t,a]=i.useState(""),n=()=>{s(_.setPhoneNumber(t))};return e.jsxs("div",{className:N.wrapper,children:[e.jsx(S,{onChange:a,placeholder:"Формат ввода номера 79116770000",className:N.input}),e.jsx(y,{onClick:n,children:"Start"})]})},G=i.memo(F),z="_wrapper_uvr47_1",O={wrapper:z},Q="_wrapper_1ovnp_1",U="_incoming_1ovnp_7",q="_outcoming_1ovnp_13",J="_time_1ovnp_19",r={wrapper:Q,incoming:U,outcoming:q,time:J},j=({data:s})=>{const t=s.type===k.incoming;return e.jsxs("div",{className:B(r.wrapper,t?r.incoming:r.outcoming),children:[e.jsx("div",{className:r.message,children:s.textMessage}),e.jsx("div",{className:r.time,children:s.formattedTime})]})},K=3e3,V=()=>{const s=h(),t=i.useRef(null),a=p(I),n=p(b),c=p(E),l=!(a.idInstance&&a.apiTokenInstance&&n),[d,{isLoading:g}]=D(),{data:u=[]}=M({...a,phoneNumber:n},{skip:l}),f=l||g,{data:o,isFetching:w,isUninitialized:C}=T({...a,phoneNumber:n},{skip:f,refetchOnFocus:!0,pollingInterval:K}),$=async m=>{await d({...a,id:m}).unwrap()};return i.useEffect(()=>{if(!C&&!w&&o){const m=o.receiptId;s(_.setNotification(o)),m&&$(m);return}},[o]),i.useEffect(()=>{t.current&&t.current.scrollTo(0,t.current.scrollHeight)},[c,u]),{chatHistory:u,notifications:c,isFetching:w,chatRef:t}},W=()=>{const{chatHistory:s,notifications:t,chatRef:a}=V();return e.jsxs("div",{className:O.wrapper,ref:a,children:[s.map(n=>e.jsx(j,{data:n},n.idMessage)),t.map(n=>e.jsx(j,{data:n},n.idMessage))]})},X="_wrapper_r4dm0_1",Y="_input_r4dm0_7",v={wrapper:X,input:Y},Z=()=>{const s=h(),t=p(I),a=p(b),[n,c]=i.useState(""),[l,{isLoading:d}]=A(),g=!(t.idInstance&&t.apiTokenInstance&&n.trim())||d,u=()=>{c("")};return{message:n,isDisabled:g,setMessage:c,onSubmit:async()=>{const o=await l({idInstance:t.idInstance,apiTokenInstance:t.apiTokenInstance,phoneNumber:a,message:n}).unwrap();s(_.setNotification(o)),u()}}},ee=()=>{const{message:s,setMessage:t,onSubmit:a,isDisabled:n}=Z();return e.jsxs("div",{className:v.wrapper,children:[e.jsx(S,{onChange:t,value:s,className:v.input}),e.jsx(y,{onClick:a,disabled:n,children:"Send"})]})},se="_wrapper_sblll_1",te={wrapper:se},ne=()=>e.jsxs("div",{className:te.wrapper,children:[e.jsx(G,{}),e.jsx(W,{}),e.jsx(ee,{})]}),oe=()=>e.jsx("div",{className:x.wrapper,children:e.jsx("div",{className:x.container,children:e.jsx(ne,{})})});export{oe as default};
